<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Game of Life | goYippi labs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style type="text/css">
      @font-face {
        font-family: 'Source Sans Pro';
        font-style: normal;
        font-weight: 400;
        src: url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.eot'); /* IE9 Compat Modes */
        src: local('Source Sans Pro Regular'), local('SourceSansPro-Regular'),
             url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
             url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.woff2') format('woff2'), /* Super Modern Browsers */
             url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.woff') format('woff'), /* Modern Browsers */
             url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.ttf') format('truetype'), /* Safari, Android, iOS */
             url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.svg#SourceSansPro') format('svg'); /* Legacy iOS */
      }
			html, body {
				width: 100%;
				height: 100%;
			}
      body {
        font-family: 'Source Sans Pro', Arial, sans-serif;
        font-size: 1.063em;
        line-height: 1.5;
        color: #000;
        margin: 0;
        padding: 0;
		    position: relative;
      }
      table {
        border-collapse: collapse;
        margin: 50px auto;
      }
      table td {
        border: 1px solid #000;
        width:10px;
        height: 10px;
        transition: background-color 0.2;
      }
      .active {
        background-color: #9bf442;;
      }
      .will-live {
        background-color: rgba(155, 244, 66, 0.6);
      }
      .will-die {
        background-color: rgba(254, 0, 0, 0.3);
      }
      .input, .step {
        text-align: center;
      }
      input {
          font-family: 'Source Sans Pro', Arial, sans-serif;
          font-size: 1.063em;
          border: 1px solid #000;
          background-color: #FFF;
          width: 99%;
          max-width: 260px;
          padding: 3px 1px;
          border-radius: 0;
          margin-bottom: 10px;
          -webkit-appearance: none;
      }
      input::-webkit-input-placeholder {
          color: #000;
          opacity: 1;
      }
      input:-ms-input-placeholder{
          color: #000;
          opacity: 1;
      }
      input::-moz-placeholder {
          color: #000;
          opacity: 1;
      }
      input:-moz-placeholder {
          color: #000;
          opacity: 1;
      }
      button {
        font-family: 'Source Sans Pro', Arial, sans-serif;
        font-size: 1.063em;
        border: 0;
        color: #000;
        background-color: #d8d8d8;
        width: auto;
        padding: 3px 6px;
        border-radius: 0;
        margin-bottom: 6px;
        cursor: pointer;
        -webkit-appearance: none;
      }
      .iteration-running .input {
        opacity: 0;
      }
    </style>
  </head>
  <body>
    <div class="input">
      <button class="play">Run iterations</button>
      <button class="run">Next step</button>
      <button class="reset">Reset</button>
    </div>
    <div class="step"><span class="step-count">0</span> Steps</div>

    <div id="table"></div>

    <div class="input">
      <p>
        <label for="iterations">Number of Iterations</label><br />
        <input id="iterations" type="number" value="" placeholder="20" min="10" max="100" pattern="\d*" />
      </p>
      <!--<p>
        <label for="fieldsize">Change Fieldsize</label><br />
        <input id="fieldsize" type="number" value="10" placeholder="10" />
        <button class="change-field">Apply</button>
      </p>-->
    </div>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script type="text/javascript">
      var rowNum = 20,
          colNum = 20,
          iterations = 20,
          step = 0,
          aliveCount = 0,
          colorClasses = ['active', '', ''];

      function tableCreate(){
        var body = document.getElementById('table');
            tbl  = document.createElement('table');

        jQuery('#table').empty();

        for(var i = 0; i < rowNum; i++){
          var tr = tbl.insertRow();
          for(var j = 0; j < colNum; j++){
            var td = tr.insertCell();
          }
        }
        body.appendChild(tbl);
      }

      function getData() {
        var data = Array();

        jQuery('table tr').each(function(i){
          data[i] = Array();
          jQuery(this).children('td').each(function(ii){
            data[i][ii] = jQuery(this).hasClass('active') ? true : false;
          });
        })

        //console.log(data);

        return data;
      }

      function checkSurroundedCells(yPos,xPos,data) {
        for (var j = yPos-2; j <= yPos; j++) {
          for (var i = xPos-2; i <= xPos; i++) {
            if (i>=0 && i<colNum && j>=0 && j<rowNum) {
              if (data[j][i] == true) {
                aliveCount++;
              }
            }
          }
        }
      }

      function checkCells() {
        var data = getData();

        jQuery('td').each(function(){
          aliveCount = 0;

          var xPos = jQuery(this).index()+1,
              yPos = jQuery(this).parent().index()+1;

          checkSurroundedCells(yPos,xPos,data);

          // will die
          if (jQuery(this).hasClass('active') && (aliveCount < 3 || aliveCount > 4) ) {
            jQuery(this).addClass('will-die');
          }
          // will survice
          if (jQuery(this).hasClass('active') && (aliveCount == 3 || aliveCount == 4) ) {
            jQuery(this).addClass('will-live');
          }
          // will live
          if (!jQuery(this).hasClass('active') && aliveCount == 3) {
            jQuery(this).addClass('will-live');
          }
        });
      }

      function writeCells() {
        jQuery('td').each(function(){
          if (jQuery(this).hasClass('will-live')) {
            jQuery(this).addClass('active');
          }
          if (jQuery(this).hasClass('will-die')) {
            jQuery(this).removeClass('active');
          }
        });
        setTimeout(function(){
          jQuery('td').each(function(){
            jQuery(this).removeClass('will-live').removeClass('will-die');
          });
        }, 400);
      }

      jQuery(document).ready(function($) {
        tableCreate();

        jQuery('td').each(function(){
          classIndex = Math.floor(Math.random() * colorClasses.length);
          $(this).addClass(colorClasses[classIndex]);
        });
      });

      jQuery(document).on('click touchstart', 'td', function() {
				jQuery(this).toggleClass('active');
			});

      jQuery(document).on('click', '.reset', function() {
        step = 0;
        jQuery('.step-count').text(step);
        jQuery('td').each(function(){
          jQuery(this).removeClass('active');
        });
			});

      jQuery(document).on('click', '.run', function() {
        step++;
        jQuery('.step-count').text(step);
        checkCells();
        writeCells();
			});

      jQuery(document).on('click', '.play', function() {
        jQuery('body').addClass('iteration-running');
        if(jQuery('#iterations').val()) {
          iterations = jQuery('#iterations').val();
        }
        var loop_i = 0;
        for (i = 0; i < iterations; i++) {
          setTimeout(function(){
            step++;
            loop_i++;
            jQuery('.step-count').text(step);
            checkCells();
            writeCells();
            if (loop_i == iterations) {
              jQuery('body').removeClass('iteration-running');
            }
          }, i * 1000);
        }
			});

      var clicked = false;

      jQuery(document).on('click', '.change-field', function() {
        if(jQuery('#fieldsize').val()) {
          rowNum = jQuery('#fieldsize').val();
          colNum = jQuery('#fieldsize').val();
          tableCreate();
        }
			});
    </script>
	</body>
</html>
